process_contexts() {
  set -x
  local index=0
  local random=$RANDOM
  local session="session-${random}"
  local split_times=$(($#-1))
  tmux new-session -d -s $session \; switch-client -t $session

  while [[ $split_times -gt 0 ]] ; do
    tmux split-window -h -t $session
    ((split_times--))
  done
    tmux send-keys -t $session:0.0 "tmux select-layout even-horizontal" C-m
  for context in $@; do
    tmux send-keys -t $session:0.$index "k9s --context $context" C-m
    ((index++))
  done
}

usage() {
    figlet -f slant "k10s"
    cat <<EOT
k10s is a CLI that wraps k9s allowing you to start multiple k9s instances at once.

Usage: k10s [flags]

Flags:
    -c, --context   List of contexts to start up
    -h, --help      Help for k10s

EOT
    exit 0
}

main() {
  if [ $# -eq 0 ]; then
      usage
  fi

  while [[ $# -gt 0 ]]; do
    case $1 in 
    -c | --context ) 
      shift
      contexts=()
      while [[ "$1" != "" && "$1" != -* ]]; do
          contexts+=("$1")
          shift
      done
      process_contexts "${contexts[@]}" # Call the function with all contexts
      ;;
    -h | --help )
      shift
      usage
      ;;
    * )
      shift
      usage
      ;;
    esac
    shift
  done
}

main $*